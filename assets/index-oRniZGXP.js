(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();const s={day:document.getElementById("current-day"),timePill:document.getElementById("time-context"),weeklyTitle:document.getElementById("weekly-title"),xpDisplay:document.getElementById("daily-xp-display"),status:document.getElementById("daily-status"),streak:document.getElementById("streak-display"),weekRow:document.getElementById("week-row"),forecast:document.getElementById("forecast-display"),muscle:document.getElementById("muscle-group"),masai:document.getElementById("masai-indicator"),exList:document.getElementById("exercise-list"),wBtn:document.getElementById("workout-btn"),nutList:document.getElementById("nutrition-list"),posList:document.getElementById("posture-list"),sBtn:document.getElementById("sleep-btn"),sleepCard:document.getElementById("sleep-card"),tierName:document.getElementById("tier-name"),userTitle:document.getElementById("user-title"),rankStreak:document.getElementById("rank-streak-display"),rankSub:document.getElementById("rank-subtitle"),rankTool:document.getElementById("rank-tooltip"),xpCont:document.getElementById("xp-container"),xpText:document.getElementById("xp-text-row"),curXP:document.getElementById("current-xp"),nextXP:document.getElementById("next-xp"),xpBar:document.getElementById("xp-bar"),animCont:document.getElementById("badge-anim-container"),badgeShape:document.getElementById("rank-badge-shape"),statTotal:document.getElementById("stat-total-xp"),statPerf:document.getElementById("stat-perfect"),statTime:document.getElementById("stat-time"),screens:document.querySelectorAll(".screen"),navItems:document.querySelectorAll(".nav-item"),timer:document.getElementById("timer-display"),manualModal:document.getElementById("manual-modal"),manualDate:document.getElementById("manual-date"),manualWorkout:document.getElementById("manual-workout"),manualSleep:document.getElementById("manual-sleep")},I="fitness_identity_v2";let Q=0,S=[];const Z=["Genesis","Friction","Momentum","Pressure","Threshold","Stability","Flow","Iron","Ascent"],z={Monday:{muscle:"Training Focus: Chest / Triceps",exercises:["Push-ups: 3 × 12–15","Incline Push-ups: 3 × 10–12","Floor DB Fly: 3 × 12","Close-grip Push-ups: 3 × 8–10","Overhead DB Tricep Ext: 3 × 12"],masai:!1},Tuesday:{muscle:"Training Focus: Back / Biceps",exercises:["Pull-ups / Door Rows: 3 × 6–10","One-arm DB Row: 3 × 10","DB RDL (light): 2 × 12","DB Curl: 3 × 12","Hammer Curl: 3 × 10–12"],masai:!1},Wednesday:{muscle:"Training Focus: Legs / Abs / Impact",exercises:["Squats: 3 × 15","Forward Lunges: 3 × 10","Glute Bridges: 3 × 12","Calf Raises: 3 × 20","Plank: 3 × 30–45s","Leg Raises: 3 × 12","Masai Jumps: 3 × 12–15"],masai:!0},Thursday:{muscle:"Training Focus: Chest / Shoulders",exercises:["Decline Push-ups: 3 × 10","Wide Push-ups: 3 × 12","Standing DB Press: 3 × 10","Lateral Raises: 3 × 12–15","Front Raises: 3 × 12"],masai:!1},Friday:{muscle:"Training Focus: Back / Biceps (Var)",exercises:["Towel Row / Band Pull: 3 × 12","DB Reverse Fly: 3 × 12","Superman Hold: 3 × 25s","Concentration Curl: 3 × 10","Reverse Curl: 3 × 12"],masai:!1},Saturday:{muscle:"Training Focus: Posture / Flow",exercises:["Hanging: 5 × 30s","Wall Posture Hold: 5 × 5m","Cobra Stretch: 3 × 30s","Cat–Cow: 3 × 15","Child’s Pose: 3 × 3m","Masai Jumps: 4 × 15"],masai:!0},Sunday:{muscle:"Active Recovery",exercises:["Walk: 45 min","Light Stretching: 15 min"],masai:!1}},ee=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],O=[{id:"bf",label:"Breakfast",detail:"3 eggs, Oatmeal (60g), 2 bananas"},{id:"sn",label:"Snack",detail:"Fruit / Peanuts / Curd"},{id:"ln",label:"Lunch",detail:"Rice/Roti, Protein 100g, Dal, Salad"},{id:"pr",label:"Pre-Work",detail:"Banana + Peanuts"},{id:"po",label:"Post-Work",detail:"Milk / 2 Eggs"},{id:"dn",label:"Dinner",detail:"Roti, Veg Curry, Protein"},{id:"sl",label:"Sleep",detail:"Warm Milk + Turmeric"}],ne=[{id:"h",label:"Dead Hang"},{id:"w",label:"Wall Hold"},{id:"c",label:"Cobra"},{id:"cc",label:"Cat-Cow"},{id:"cp",label:"Child's Pose"}],k=[{minXP:0,rom:"I",name:"INITIATE",subtitle:"Initialization sequence active.",tooltip:"Entry recorded. No pattern established.",color:"#94a3b8",shape:"shape-circle",anim:"anim-foundation"},{minXP:40,rom:"II",name:"CONSISTENT",subtitle:"Routine establishment detected.",tooltip:"Repeated action detected. Variability remains.",color:"#4ade80",shape:"shape-hexagon",anim:"anim-habit"},{minXP:120,rom:"III",name:"CONDITIONED",subtitle:"Automated behavioral pattern.",tooltip:"Action occurs with reduced resistance.",color:"#2dd4bf",shape:"shape-sharp-hex",anim:"anim-habit"},{minXP:260,rom:"IV",name:"FOCUSED",subtitle:"Resource allocation optimized.",tooltip:"Distractions show declining influence.",color:"#60a5fa",shape:"shape-diamond",anim:"anim-focused"},{minXP:450,rom:"V",name:"RELENTLESS",subtitle:"Negotiation protocols disabled.",tooltip:"Comfort avoidance observed. Negotiation absent.",color:"#f472b6",shape:"shape-crest",anim:"anim-disciplined"},{minXP:700,rom:"VI",name:"ELITE",subtitle:"External impact confirmed.",tooltip:"Performance maintained without reinforcement.",color:"#fbbf24",shape:"shape-star",anim:"anim-elite"},{minXP:1e3,rom:"VII",name:"ASCENDED",subtitle:"Integration complete.",tooltip:"Behavior fully internalized. Monitoring reduced.",color:"#ffffff",shape:"shape-crown",anim:"anim-ascended"}];let l=[],c=null,M=0,E=null,v=null;const ae=I+"_undo";function ye(){try{S=JSON.parse(sessionStorage.getItem(ae))||[]}catch{S=[]}}function se(){try{sessionStorage.setItem(ae,JSON.stringify(S))}catch{}}function b(){S.push(JSON.stringify(l)),S.length>5&&S.shift(),se()}window.undoOnce=()=>{if(!S.length)return T("Nothing to undo");l=JSON.parse(S.pop()),se(),x.set(l),w(),T("Reverted")};function h(e){return typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e)}function oe(e){if(!Array.isArray(e))return[];const t=[],a=[],o=new Date;return o.setFullYear(o.getFullYear()-2),e.forEach(n=>{if(!(!n||!n.date))if(h(n.date)){if(new Date(n.date)<o)return;n.daily_xp=Number(n.daily_xp)||0,t.push(n)}else a.push(n)}),t.sort((n,i)=>new Date(n.date)-new Date(i.date)),t.concat(a)}function he(e){const t=oe(e),a=new Map;l.forEach(n=>a.set(n.date,Object.assign({},a.get(n.date)||{},n))),t.forEach(n=>a.set(n.date,Object.assign({},a.get(n.date)||{},n))),l=Array.from(a.values()).sort((n,i)=>h(n.date)&&h(i.date)?new Date(n.date)-new Date(i.date):h(n.date)?-1:h(i.date)?1:0),x.set(l)}const x={get:()=>{try{return JSON.parse(localStorage.getItem(I))||[]}catch{return window.memStorage||[]}},set:e=>{window.memStorage=e,v&&clearTimeout(v),v=setTimeout(()=>{try{localStorage.setItem(I,JSON.stringify(e))}catch{}v=null},800)},clear:()=>{window.memStorage=[],v&&clearTimeout(v);try{localStorage.removeItem(I)}catch{}}};function B(){const e=new Date;e.setDate(e.getDate()+M);const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${o}`}function we(){let e=new Date;const t=l.filter(u=>h(u.date));if(t.length>0){const u=[...t].sort((g,f)=>new Date(g.date)-new Date(f.date));e=new Date(u[0].date)}const a=new Date(B()),o=Math.max(0,a-e),n=Math.floor(o/(1e3*60*60*24))+1,i=Math.ceil(n/90),d=Math.ceil(n/7),m=(n-1)%7+1;return{season:i,chapter:d,dayInChapter:m,totalDays:n}}function ie(e){const a=[...e].filter(o=>h(o.date)).sort((o,n)=>new Date(n.date)-new Date(o.date)).slice(0,3);return a.length<3?!1:a.every(o=>!o.sleep_planned)}function xe(e){const a=[...e].filter(n=>h(n.date)).sort((n,i)=>new Date(i.date)-new Date(n.date)).filter(n=>n.date!==c.date);let o=0;for(let n=0;n<3;n++)a[n]&&a[n].daily_xp===5&&o++;return o>=3}function re(e,t){if(e.length<1)return!1;const o=[...e].filter(u=>h(u.date)).sort((u,g)=>new Date(g.date)-new Date(u.date)).filter(u=>u.date!==(t||c&&c.date));if(o.length===0)return!1;const n=new Date(o[0].date),i=new Date(t||c&&c.date),d=Math.abs(i-n);return Math.ceil(d/(1e3*60*60*24))>=14}function ve(e){const t=new Map;for(const m of e)h(m.date)&&t.set(m.date,m);const a=new Date(B());let o=0;const n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,i=t.get(n);let d=i&&i.daily_xp>0?0:1;for(let m=d;;m++){const u=new Date(a);u.setDate(u.getDate()-m);const g=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`,f=t.get(g);if(f&&f.daily_xp>0)o++;else break;if(o>3650)break}return o}function Te(e){return e.filter(t=>h(t.date)&&(t.daily_xp||0)>0).length}function le(e,t,a){if(e.manual)return e.daily_xp;if(!e)return 0;const o=A(e);if(e.workout_done&&o<50||!re(t,e.date)&&ie(t)&&a>=4)return 5;const i=e.workout_done?1:0,d=O.filter(f=>f.id!=="sl").filter(f=>e.meals&&e.meals[f.id]).length,m=Object.values(e.posture||{}).filter(Boolean).length,u=O.filter(f=>f.id!=="sl").length+ne.length,g=(d+m)/u;return i&&g>.75?10:i||g>.4?xe(t)?3:5:0}function A(e){if(!e||!e.meals)return 0;const t=O.filter(o=>o.id!=="sl"&&!o.negative),a=t.filter(o=>e.meals[o.id]).length;return Math.round(a/t.length*100)||0}function be(e){let t=0;return e.forEach(a=>{if(!h(a.date))return;new Date(a.date).getDay()===1&&a.daily_xp>0&&t++}),t>=3}function Se(e,t,a){const o=[],n=A(t);t.workout_done&&n<50?o.push({text:"Fuel deficit detected.",priority:5}):a>7?o.push({text:"Momentum maintained.",priority:4}):!t.workout_done&&t.sleep_planned?o.push({text:"Restructuring phase.",priority:3}):n>=90?o.push({text:"Optimal input recorded.",priority:3}):o.push({text:"Action verified.",priority:1});const i=o.sort((u,g)=>g.priority-u.priority)[0];let d="Novice";return a>=3&&(d="Consistent"),be(e)&&(d="Monday Retention"),A(t)>=85&&a>5&&(d="Fuel Optimization"),a>=14&&(d="High Continuity"),e.reduce((u,g)=>u+(g.daily_xp||0),0)>=1e3&&(d="Integration"),{tag:i.text,title:d}}function ke(e){const t=[...e].filter(n=>h(n.date)).sort((n,i)=>new Date(i.date)-new Date(n.date));let a=0,o=0;for(let n=0;n<3;n++){const i=t[n];if(!i)continue;const d=i.daily_xp;d>=10&&a++,n<2&&d===0&&o++}return a>=3?"Momentum":o>=2?"Friction":"Neutral"}function $(e,t){return e>=6?!1:e===5?t==="system":e===4?t==="warning"||t==="system":e===3?t!=="routine":e===2?t==="exception"||t==="completion":e===1?t!=="repeated":!0}function T(e,t=1800){const a=document.getElementById("toast")||(()=>{const o=document.createElement("div");return o.id="toast",document.body.appendChild(o),o})();a.innerText=e,a.style.display="block",a.style.opacity="1",clearTimeout(a._hide),a._hide=setTimeout(()=>{a.style.opacity="0",a.style.display="none"},t)}let Y=!1;function w(){if(!Y){Y=!0;try{const e=B();c=l.find(r=>r.date===e),c||(c={date:e,workout_done:!1,sleep_planned:!1,meals:{},posture:{},exercises:{},daily_xp:0},l.push(c),x.set(l));const t=l.reduce((r,y)=>r+(y.daily_xp||0),0);let a=k[0],o=null,n=0;for(let r=0;r<k.length&&t>=k[r].minXP;r++)a=k[r],o=k[r+1]||null,n=r;const i=le(c,l,n);c.daily_xp!==i&&(c.daily_xp=i,x.set(l));const d=c.daily_xp,m=we();s.timePill.innerText=`S${m.season} : CH ${m.chapter}`;const u=Z[(m.chapter-1)%Z.length]||"Uncharted";s.weeklyTitle.innerText=`CHAPTER ${m.chapter}: ${u}`;const g=A(c);let f=ke(l);const ce=ie(l),X=n>=5,de=re(l,c.date),R=ve(l),ue=Te(l);let W=1.15,V="cubic-bezier(0.34, 1.56, 0.64, 1)";R>14?(W=1,V="cubic-bezier(0, 0, 0.2, 1)"):R>5&&(W=1.05),document.documentElement.style.setProperty("--check-scale",W),document.documentElement.style.setProperty("--check-spring",V);let D="grayscale(0) brightness(1)",P=1,H="0.4s";document.body.className="",document.body.classList.add(`season-${(m.season-1)%4+1}`),document.body.classList.add(`tier-${n}`),X&&document.body.classList.add("elite-mode"),g>=85?(D="grayscale(0) contrast(1.1) brightness(1.1)",P=1):g<50&&(D="grayscale(0.4) brightness(0.8)",P=.4),de?(f="Neutral",s.status.innerText="System Resumed",s.status.style.color="#fff"):(f==="Momentum"?(H="0.2s",D+=" saturate(1.2)"):f==="Friction"&&(H="0.6s",D="grayscale(0.8) contrast(1.2) brightness(0.7)",P=.2),ce&&n>=4?(D="grayscale(1) brightness(0.5)",P=.1,s.sBtn.classList.add("pulse-debt"),s.status.innerText="RECOVERY DEBT DETECTED",s.status.classList.add("debt-active")):(s.sBtn.classList.remove("pulse-debt"),s.status.classList.remove("debt-active"),$(n,"completion")?d===10?(s.status.innerText="Day Recorded",s.status.style.color=a.color):d===5?(s.status.innerText="Partial Entry",s.status.style.color="#fff"):d===3?(s.status.innerText="Diminished Entry",s.status.style.color="#94a3b8"):(s.status.innerText="No Record",s.status.style.color="var(--text-secondary)"):s.status.innerText=""));const C=document.documentElement;if(C.style.setProperty("--app-filter",D),C.style.setProperty("--glow-opacity",P),C.style.setProperty("--transition-speed",H),C.style.setProperty("--rank-color",a.color),C.style.setProperty("--rank-glow",o?`0 0 30px ${a.color}`:`0 0 60px ${a.color}`),M!==0||(s.day.style.display="none"),s.xpDisplay.innerText=d,X){const r=f==="Momentum"?"↑":f==="Friction"?"↓":"—";s.streak.innerText=r,s.streak.classList.add("ghost")}else s.streak.innerText=`${ue} Entries`,s.streak.classList.remove("ghost");const me=new Date().getHours();if(M===0&&me>=20){const r=new Date;r.setDate(r.getDate()+1);const y=ee[r.getDay()],p=z[y].muscle.replace("Training Focus: ","");s.forecast.innerText=`TOMORROW EXPECTS: ${p}`,s.forecast.classList.add("visible")}else s.forecast.classList.remove("visible");const pe=["S","M","T","W","T","F","S"],fe=new Map(l.filter(r=>h(r.date)).map(r=>[r.date,r]));s.weekRow.innerHTML=Array.from({length:7},(r,y)=>{const p=new Date;p.setDate(p.getDate()+M-(6-y));const L=`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}-${String(p.getDate()).padStart(2,"0")}`,_=fe.get(L),U=_?_.daily_xp:0,ge=U>=10?"perfect":U>=3?"partial":"missed";return`<div class="day-col ${6-y===0?"today":""}"><div class="day-bar ${ge}"></div><div class="day-text">${pe[p.getDay()]}</div></div>`}).join("");const J=new Date;J.setDate(J.getDate()+M);const j=z[ee[J.getDay()]]||z.Monday;s.muscle.innerText=j.muscle,s.masai.innerHTML=j.masai?'<div style="background:rgba(245,158,11,0.1); color:var(--accent-amber); padding:10px; border-radius:12px; font-size:12px; font-weight:700; text-align:center; margin-bottom:16px; border:1px solid rgba(245,158,11,0.2);">High Impact Session<div style="font-size:10px; opacity:0.7; margin-top:4px;">Joints and recovery expected.</div></div>':"",s.exList.innerHTML=j.exercises.map((r,y)=>{const[p,L]=r.split(":"),_=c.exercises&&c.exercises[y];return`<div class="list-row exercise-row ${c.workout_done||_?"checked":""}" onclick="toggleExercise(${y})"><div class="check-ring"></div><div class="ex-info"><div class="ex-name">${p}</div><div class="ex-reps">${L}</div></div></div>`}).join(""),c.workout_done?(s.wBtn.classList.add("completed"),s.wBtn.innerText=$(n,"completion")?"Session Logged":"Recorded"):(s.wBtn.classList.remove("completed"),s.wBtn.innerText="Log Session");const q=(r,y)=>r.map(p=>{if(p.tier&&n<p.tier)return"";const L=c[y]&&c[y][p.id]?"checked":"";return`<div class="checklist-row ${p.negative?"negative":""} ${L}" onclick="toggleCheck('${y}','${p.id}')"><div class="check-circle"><svg viewBox="0 0 24 24" class="check-icon"><polyline points="20 6 9 17 4 12"></polyline></svg></div><div class="checklist-content"><div class="checklist-label">${p.label}</div>${p.detail?`<div class="checklist-detail">${p.detail}</div>`:""}</div></div>`}).join("");s.nutList.innerHTML=q(O,"meals"),s.posList.innerHTML=q(ne,"posture"),c.sleep_planned?(s.sBtn.classList.add("completed"),s.sBtn.innerText=$(n,"completion")?"Recovery Logged":"Recorded",s.sleepCard.style.borderColor=a.color):(s.sBtn.classList.remove("completed"),s.sBtn.innerText="Log Sleep Intent",s.sleepCard.style.borderColor="var(--border-subtle)");const N=Se(l,c,R);if(s.tierName.innerText="CURRENT STANDING: "+a.name,s.userTitle.innerText=N.title,s.rankStreak.innerText=`${R} DAY STREAK`,s.tierName.style.color=a.color,s.rankSub.innerText=a.subtitle,!$(n,"tooltip")||X){s.rankTool.innerHTML="";const r=document.createElement("span");r.className="silence-icon",r.innerText="?",r.setAttribute("data-tooltip","Silence Protocol: Distractions removed to optimize cognitive load for high-tier performance."),s.rankTool.appendChild(r)}else{let r=a.tooltip;(N.tag==="Fuel deficit detected."||N.tag==="Restructuring phase.")&&(r=N.tag),s.rankTool.innerText=r}s.statTotal.innerText=t,s.statPerf.innerText=l.filter(r=>r.daily_xp===10).length;const G=Math.floor(m.totalDays/30);if(s.statTime.innerText=G<1?m.totalDays+" Days":G+" Months",n>=5)s.xpCont.style.display="none",s.xpText.style.display="none";else{s.xpCont.style.display="block",s.xpText.style.display="flex";const r=t-a.minXP,y=o?o.minXP-a.minXP:1;s.curXP.innerText=Math.floor(r)+" XP",s.nextXP.innerText="Distance to next standing",s.xpBar.style.width=Math.min(100,r/y*100)+"%"}s.animCont.className=`badge-container ${a.anim}`,s.badgeShape.className=`badge-shape ${a.shape}`,s.badgeShape.style.boxShadow=`0 0 40px ${a.color}`}finally{Y=!1}}}function F(){const e=Date.now();return e-Q<300?!1:(Q=e,!0)}window.toggleCheck=(e,t)=>{F()&&(b(),c[e]||(c[e]={}),c[e][t]=!c[e][t],setTimeout(w,300))};window.toggleExercise=e=>{F()&&(b(),c.exercises||(c.exercises={}),c.exercises[e]=!c.exercises[e],setTimeout(w,300))};window.switchTab=(e,t)=>{s.screens.forEach(a=>a.classList.remove("active")),document.getElementById("screen-"+e).classList.add("active"),s.navItems.forEach(a=>a.classList.remove("active")),t.classList.add("active")};window.toggleWorkout=()=>{F()&&(b(),c.workout_done=!c.workout_done,setTimeout(w,300))};window.toggleSleep=()=>{F()&&(b(),c.sleep_planned=!c.sleep_planned,setTimeout(w,300))};window.startTimer=e=>{E&&clearInterval(E);let t=e;s.timer.innerText=`00:${t}`,E=setInterval(()=>{t--,s.timer.innerText=t<10?`00:0${t}`:`00:${t}`,t<=0&&(clearInterval(E),s.timer.innerText="DONE")},1e3)};window.stopTimer=()=>{E&&clearInterval(E),s.timer.innerText="00:00"};window.addTestXP=()=>{b();const e=B();let t=l.find(a=>a.date===e);t||(t={date:e,workout_done:!0,sleep_planned:!1,meals:{},posture:{},exercises:{},daily_xp:0,manual:!0},l.push(t)),t.workout_done=!0,t.daily_xp=Math.min(100,(t.daily_xp||0)+50),x.set(l),w()};let te;window.confirmReset=e=>{e.innerText==="Reset"?(e.innerText="Confirm?",e.style.color="#ef4444",e.style.borderColor="#ef4444",te=setTimeout(()=>{e.innerText="Reset",e.style.color="#555",e.style.borderColor="#333"},3e3)):(clearTimeout(te),b(),x.clear(),l=[],w(),T("All data reset."),e.innerText="Reset",e.style.color="#555",e.style.borderColor="#333")};window.openManual=()=>{s.manualModal.classList.add("open"),s.manualDate.value=B(),s.manualWorkout.checked=!1,s.manualSleep.checked=!1};window.closeManual=()=>{s.manualModal.classList.remove("open")};window.saveManual=()=>{const e=s.manualDate.value;if(!e)return;let t=l.find(n=>n.date===e);t||(t={date:e,workout_done:!1,sleep_planned:!1,meals:{},posture:{},exercises:{},daily_xp:0},l.push(t)),b(),t.workout_done=s.manualWorkout.checked,t.sleep_planned=s.manualSleep.checked;const a=l.reduce((n,i)=>n+(i.daily_xp||0),0);let o=0;for(let n=0;n<k.length&&a>=k[n].minXP;n++)o=n;t.daily_xp=le(t,l,o),t.manual=!0,x.set(l),closeManual(),w()};window.exportData=()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(l)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","obsidian_backup_"+B()+".json"),document.body.appendChild(t),t.click(),t.remove()};window.handleImport=e=>{const t=e.files[0];if(!t)return;const a=new FileReader;a.onload=o=>{try{const n=JSON.parse(o.target.result);if(Array.isArray(n)){b();const i=n.filter(d=>h(d.date)).length;he(n),w(),T(`Imported ${i} day(s).`)}else T("Invalid file format.")}catch{T("Error reading file.")}},a.readAsText(t)};document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&x.set(l)});window.addEventListener("beforeunload",()=>{try{v&&(clearTimeout(v),v=null),localStorage.setItem(I,JSON.stringify(l))}catch{}});const K=I+"_autobackup_",De=5;setInterval(()=>{try{const e=Date.now(),t=K+e;localStorage.setItem(t,JSON.stringify(l));const a=Object.keys(localStorage).filter(o=>o.startsWith(K)).sort();for(;a.length>De;)localStorage.removeItem(a.shift())}catch{}},1e3*60*60*6);window.restoreLatestBackup=()=>{const e=Object.keys(localStorage).filter(t=>t.startsWith(K)).sort();if(!e.length)return T("No backup found");b(),l=JSON.parse(localStorage.getItem(e[e.length-1])),x.set(l),w(),T("Backup restored")};s.navItems.forEach(e=>{e.tabIndex=0,e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e.click())})});"serviceWorker"in navigator&&(navigator.serviceWorker.register("/service-worker.js").then(e=>{e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&T("Update available — click to reload",8e3)})})}).catch(e=>console.warn("SW reg failed",e)),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}),document.addEventListener("click",e=>{e.target.id==="toast"&&e.target.innerText.includes("Update")&&navigator.serviceWorker.getRegistration().then(t=>{t&&t.waiting&&t.waiting.postMessage({type:"SKIP_WAITING"})})}));ye();l=oe(x.get());w();
